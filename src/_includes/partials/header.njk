<style>
    .header {
        position: sticky;
        top: 0;
        background-color: var(--white);
        box-shadow: var(--shadow-sm);
        z-index: 1000;
        transition: var(--transition);
    }

    .header.scrolled {
        box-shadow: var(--shadow-md);
        background-color: rgba(255, 255, 255, 0.98);
        /* Avoid backdrop-filter for smoother vertical scroll */
    }

    .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-sm) 0;
    }

    .logo {
        display: flex;
        align-items: center;
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--blue-700);
    }

    .logo-img {
        height: 40px;
        width: auto;
    }

    .nav-menu {
        display: flex;
        gap: var(--spacing-lg);
        align-items: center;
    }

    .nav-link {
        color: var(--text);
        font-weight: 500;
        position: relative;
        padding: var(--spacing-xs) 0;
    }

    .nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background-color: var(--blue-700);
        transition: var(--transition);
    }

    .nav-link:hover::after,
    .nav-link.active::after {
        width: 100%;
    }

    .nav-link:hover,
    .nav-link.active {
        color: var(--blue-700);
    }

    .nav-link:focus {
        outline: 2px solid var(--blue-700);
        outline-offset: 4px;
        border-radius: 2px;
    }

    /* Dropdown meni */
    .nav-item-dropdown {
        position: relative;
    }

    .nav-link-dropdown {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        justify-content: space-between;
    }

    .dropdown-arrow {
        font-size: 0.7rem;
        transition: var(--transition-fast);
        display: inline-block;
    }

    .nav-item-dropdown:hover .dropdown-arrow,
    .nav-item-dropdown.active .dropdown-arrow {
        transform: rotate(180deg);
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--white);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        min-width: 220px;
        padding: var(--spacing-sm) 0;
        margin-top: var(--spacing-xs);
        opacity: 0;
        visibility: hidden;
        transform: translateX(-50%) translateY(-10px);
        transition: var(--transition);
        z-index: 1000;
        list-style: none;
    }

    .nav-item-dropdown:hover .dropdown-menu,
    .nav-item-dropdown.active .dropdown-menu {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0);
    }

    .dropdown-link {
        display: block;
        padding: var(--spacing-sm) var(--spacing-lg);
        color: var(--text);
        font-weight: 500;
        transition: var(--transition-fast);
        text-decoration: none;
    }

    .dropdown-link:hover {
        background-color: var(--gray-50);
        color: var(--blue-700);
        padding-left: calc(var(--spacing-lg) + 0.5rem);
    }

    /* Hamburger meni */
    .hamburger {
        display: none;
        flex-direction: column;
        gap: 4px;
        background: none;
        border: none;
        cursor: pointer;
        padding: var(--spacing-xs);
        z-index: 1001;
    }

    .hamburger span {
        width: 25px;
        height: 3px;
        background-color: var(--text);
        border-radius: 2px;
        transition: var(--transition);
    }

    .hamburger[aria-expanded="true"] span:nth-child(1) {
        transform: rotate(45deg) translate(6px, 6px);
    }

    .hamburger[aria-expanded="true"] span:nth-child(2) {
        opacity: 0;
    }

    .hamburger[aria-expanded="true"] span:nth-child(3) {
        transform: rotate(-45deg) translate(6px, -6px);
    }

    .hamburger:focus {
        outline: 2px solid var(--blue-700);
        outline-offset: 2px;
        border-radius: 2px;
    }

    .mobile-menu-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 23, 0.5);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s ease;
        z-index: 990;
    }

    .mobile-menu-backdrop.active {
        opacity: 1;
        pointer-events: auto;
    }

    /* Mobilni meni */
    @media (max-width: 1023px) {
        .hamburger {
            display: flex;
        }

        .nav-menu {
            position: fixed;
            top: 0;
            right: -110%;
            width: min(88vw, 340px);
            height: 100vh;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.98));
            flex-direction: column;
            padding: calc(var(--spacing-2xl) + 0.5rem + env(safe-area-inset-top, 0px)) var(--spacing-lg) calc(var(--spacing-xl) + env(safe-area-inset-bottom, 0px));
            box-shadow: var(--shadow-lg);
            transition: right 0.28s ease, opacity 0.25s ease;
            gap: var(--spacing-md);
            align-items: flex-start;
            border-left: 1px solid rgba(15, 23, 42, 0.08);
            opacity: 0;
            z-index: 1000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .nav-menu.active {
            right: 0;
            opacity: 1;
        }

        .nav-link {
            font-size: 1.05rem;
            width: 100%;
            padding: 0.75rem 0.85rem;           
        }

        .nav-link::after {
            display: none;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(0, 94, 131, 0.1);
            border-color: rgba(0, 94, 131, 0.2);
        }

        .nav-item-dropdown {
            width: 100%;
        }

        .nav-link-dropdown {
            width: 100%;
        }

        .dropdown-arrow {
            margin-left: auto;
        }

        .dropdown-menu {
            position: static;
            transform: none;
            opacity: 0;
            visibility: hidden;
            box-shadow: none;
            background-color: transparent;
            padding: 0;
            margin-top: 0;
            margin-left: var(--spacing-md);
            width: calc(100% - var(--spacing-md));
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.28s ease, opacity 0.2s ease;
            border-left: 2px solid rgba(0, 94, 131, 0.2);
        }

        .nav-item-dropdown:hover .dropdown-menu,
        .nav-item-dropdown.active .dropdown-menu {
            transform: none;
            opacity: 1;
            visibility: visible;
            max-height: 520px;
            padding: 0.25rem 0;
        }

        .dropdown-link {
            padding: 0.6rem var(--spacing-md);
            font-size: 0.95rem;
            border-radius: 0.45rem;
            background: rgba(241, 245, 249, 0.75);
            margin-bottom: 0.25rem;
        }

        .dropdown-link:hover {
            padding-left: var(--spacing-md);
            background: rgba(0, 94, 131, 0.08);
        }
    }
</style>

<header class="header" id="header">
    <div class="container">
        <nav class="nav">
            <a href="#home" class="logo">
                <!-- Lazy-load non-hero images to reduce initial payload -->
                <img src="/images/smiz.png" alt="SMIŽ Logo" class="logo-img" loading="lazy" decoding="async">
            </a>
            <ul class="nav-menu" id="navMenu">
                <li><a href="/" class="nav-link">Početna</a></li>
                <li><a href="/o-nama/" class="nav-link">O nama</a></li>
                <li class="nav-item-dropdown">
                    <a href="#proizvodi" class="nav-link nav-link-dropdown" id="productsDropdown">
                        Proizvodi
                        <span class="dropdown-arrow">▼</span>
                    </a>
                    <ul class="dropdown-menu" id="productsDropdownMenu">
                        <li><a href="/proizvodi/automatska-vrata/" class="dropdown-link">Automatska vrata</a></li>
                        <li><a href="/proizvodi/bolnicka-vrata/" class="dropdown-link">Bolnička vrata</a></li>
                        <li><a href="/proizvodi/unutrasnja-vrata/" class="dropdown-link">Unutrašnja vrata</a></li>
                        <li><a href="/proizvodi/industrijska-vrata/" class="dropdown-link">Industrijska vrata</a></li>
                        <li><a href="/proizvodi/garazna-vrata/" class="dropdown-link">Garažna vrata</a></li>
                        <li><a href="/proizvodi/zastita-od-radijacije/" class="dropdown-link">Olovna stakla i olovni limovi</a></li>
                        <li><a href="/proizvodi/primax/" class="dropdown-link">PRIMAX zaštitna rešenja</a></li>
                    </ul>
                </li>
                <li><a href="/kontakt/" class="nav-link">Kontakt</a></li>
            </ul>
            <button class="hamburger" id="hamburger" aria-label="Toggle menu" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </div>
</header>

</div> <script>
    const header = document.getElementById('header');
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('navMenu');
    const navLinks = document.querySelectorAll('.nav-link');

    // ============================================
    // Hamburger Meni
    // ============================================
    if (hamburger && navMenu) {
        const closeMobileMenu = () => {
            hamburger.setAttribute('aria-expanded', 'false');
            navMenu.classList.remove('active');
            document.body.style.overflow = '';
        };

        hamburger.addEventListener('click', () => {
            const isExpanded = hamburger.getAttribute('aria-expanded') === 'true';
            hamburger.setAttribute('aria-expanded', !isExpanded);
            navMenu.classList.toggle('active');

            // Prevencija scroll-a kada je meni otvoren
            if (!isExpanded) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        });

        // Zatvori meni kada se klikne na link (ali ne zatvaraj kad je mobilni dropdown toggle)
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                const isMobile = window.innerWidth <= 1023;
                const isDropdownToggle = link.classList.contains('nav-link-dropdown') || link.id === 'productsDropdown';

                // Na mobilnom: klik na "Proizvodi" treba da otvori dropdown, ne da zatvori hamburger
                if (isMobile && isDropdownToggle) return;

                closeMobileMenu();
            });
        });


        // Zatvori meni kada se klikne van njega
        document.addEventListener('click', (e) => {
            if (navMenu.classList.contains('active') &&
                !navMenu.contains(e.target) &&
                !hamburger.contains(e.target)) {
                closeMobileMenu();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeMobileMenu();
            }
        });
    }

    // ============================================
    // Dropdown Meni
    // ============================================
    const productsDropdown = document.getElementById('productsDropdown');
    const productsDropdownMenu = document.getElementById('productsDropdownMenu');
    const navItemDropdown = document.querySelector('.nav-item-dropdown');

    if (productsDropdown && productsDropdownMenu && navItemDropdown) {
        const setDropdownState = (isOpen) => {
            navItemDropdown.classList.toggle('active', isOpen);
            productsDropdown.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        };

        // Desktop: hover
        navItemDropdown.addEventListener('mouseenter', () => {
            if (window.innerWidth > 1023) {
                setDropdownState(true);
            }
        });

        navItemDropdown.addEventListener('mouseleave', () => {
            if (window.innerWidth > 1023) {
                setDropdownState(false);
            }
        });

        const isMobileMenu = () => window.matchMedia('(max-width: 1023px)').matches;

        // Mobile: tap/click (toggle open/close) - robustno
        productsDropdown.addEventListener('pointerup', (e) => {
            if (!isMobileMenu()) return;

            e.preventDefault();     // da ne skroluje na #proizvodi
            e.stopPropagation();    // da se ne meša sa drugim click handlerima

            const isOpen = navItemDropdown.classList.contains('active');
            setDropdownState(!isOpen); // toggle
        });



        // Zatvori dropdown kada se klikne na link
        const dropdownLinks = productsDropdownMenu.querySelectorAll('.dropdown-link');
        dropdownLinks.forEach(link => {
            link.addEventListener('click', () => {
                setDropdownState(false);
                // Zatvori hamburger meni ako je otvoren
                if (hamburger && navMenu) {
                    hamburger.setAttribute('aria-expanded', 'false');
                    navMenu.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });

        // Zatvori dropdown kada se klikne van njega
        document.addEventListener('click', (e) => {
            if (!navItemDropdown.contains(e.target)) {
                setDropdownState(false);
            }
        });

        window.addEventListener('resize', () => {
            if (window.innerWidth > 1023) {
                setDropdownState(false);
            }
        });
    }

    // ============================================
    // Accessibility Improvements
    // ============================================
    // Dodaj keyboard navigation za hamburger meni
    if (hamburger) {
        hamburger.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                hamburger.click();
            }
        });
    }

    // Dodaj keyboard navigation za nav linkove
    navLinks.forEach(link => {
        link.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                link.click();
            }
        });
    });
</script>